// Generated by CoffeeScript 1.9.3
(function() {
  define(["angular", "framework/datasource/DataSourceManagerService", "framework/datasource/DataSourceDirective"], function(angular, DataSourceManagerService, DataSourceDirective) {
    var DataSourceModule;
    DataSourceModule = angular.module("DataSourceModule", []);
    DataSourceModule.factory("$dataSourceManager", DataSourceManagerService);
    DataSourceModule.factory("$dataSource", function($dataSourceManager, $rootScope, $q) {
      var DataSource;
      DataSource = (function() {
        function DataSource(sourceName, records) {
          var me;
          this.sourceName = sourceName;
          this.records = records;
          $dataSourceManager.registerDataSource(this.sourceName, this);

          /*提供监听功能 */
          $rootScope.dataSources[this.sourceName] = this;
          me = this;
          $rootScope.$watch("dataSources." + this.sourceName + ".records", function(newVal, oldVal) {
            if (angular.isUndefined($dataSourceManager.defereds[me.sourceName])) {
              $dataSourceManager.getDataSource(me.sourceName);
            }
            $dataSourceManager.defereds[me.sourceName].resolve();
            $dataSourceManager.defereds[me.sourceName] = $q.defer();
            return $rootScope.$broadcast(me.sourceName, me);
          });
        }

        return DataSource;

      })();
      return DataSource;
    });
    return DataSourceModule.directive("gDataSource", DataSourceDirective);
  });

}).call(this);
